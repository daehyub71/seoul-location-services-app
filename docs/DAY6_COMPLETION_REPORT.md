# Day 6 μ™„λ£ λ¦¬ν¬νΈ: μλ™ μμ§‘ μ‹μ¤ν… κµ¬μ¶•

**λ‚ μ§**: 2025-11-02
**μ‘μ—… λ©ν‘**: μλ™ λ°μ΄ν„° μμ§‘ μ‹μ¤ν… κµ¬μ¶• λ° μ¤μΌ€μ¤„λ§

---

## π“‹ μ‘μ—… μ”μ•½

Day 6μ—μ„λ” λ°μ΄ν„° μμ§‘ μλ™ν™”λ¥Ό μ„ν• ν•µμ‹¬ μΈν”„λΌλ¥Ό κµ¬μ¶•ν–μµλ‹λ‹¤. μ§„ν–‰μƒν™© ν‘μ‹(tqdm), μ¤μΌ€μ¤„λ§(APScheduler), λ°μ΄ν„° ν’μ§ κ²€μ¦ μ‹μ¤ν…μ„ κ°–μ¶ ν”„λ΅λ•μ…κΈ‰ μμ§‘ μ‹μ¤ν…μ„ μ™„μ„±ν–μµλ‹λ‹¤.

---

## β… μ™„λ£λ μ‘μ—…

### 1. collect_all.py - ν†µν•© μμ§‘ μ¤ν¬λ¦½νΈ
**νμΌ**: `backend/scripts/collect_all.py`

**μ£Όμ” κΈ°λ¥**:
- 5κ° Collector μμ°¨ μ‹¤ν–‰ μ¤μΌ€μ¤νΈλ μ΄μ…
- tqdm μ§„ν–‰μƒν™© ν‘μ‹
- Supabase Upsert (μ¤‘λ³µ μ‹ μλ™ μ—…λ°μ΄νΈ)
- μƒμ„Έν• μμ§‘ ν†µκ³„ λ° λ¦¬ν¬νΈ
- λ΅κ·Έ νμΌ μ €μ¥ (`logs/collect_all.log`)

**μ‚¬μ© μμ‹**:
```bash
# μ „μ²΄ μμ§‘
python collect_all.py

# ν…μ¤νΈ λ¨λ“ (κ° μ—”λ“ν¬μΈνΈ 10κ°λ§)
python collect_all.py --test

# κ° μ—”λ“ν¬μΈνΈμ—μ„ 100κ°μ”©
python collect_all.py --max-records 100

# μ΅°μ©ν• λ¨λ“ (λ΅κ·Έλ§)
python collect_all.py --quiet
```

**ν•µμ‹¬ κµ¬ν„**:
```python
class DataCollectionOrchestrator:
    """
    λ°μ΄ν„° μμ§‘ μ¤μΌ€μ¤νΈλ μ΄ν„°
    - 9κ° Collector μμ°¨ μ‹¤ν–‰ (ν„μ¬ 5κ° κµ¬ν„λ¨)
    - μ§„ν–‰μƒν™© ν‘μ‹ (tqdm)
    - Supabase Upsert (μ¤‘λ³µ μ‹ μ—…λ°μ΄νΈ)
    - μμ§‘ λ΅κ·Έ μ €μ¥
    """

    async def collect_all(self, max_records: int = None, verbose: bool = True):
        # tqdm μ§„ν–‰ λ°” ν‘μ‹
        if tqdm:
            collector_iterator = tqdm(
                enumerate(self.collectors, 1),
                total=len(self.collectors),
                desc="μ „μ²΄ μμ§‘ μ§„ν–‰",
                unit="collector"
            )

        # κ° Collector μ‹¤ν–‰ λ° ν†µκ³„ λ„μ 
        for i, (name, collector) in collector_iterator:
            stats = await collector.collect(max_records=max_records)
            self.total_stats['success'] += stats['success']
            # ...
```

### 2. scheduler.py - μλ™ μ¤μΌ€μ¤„λ¬
**νμΌ**: `backend/scripts/scheduler.py`

**μ£Όμ” κΈ°λ¥**:
- APSchedulerλ¥Ό μ‚¬μ©ν• μλ™ μ¤μΌ€μ¤„λ§
- Cron ν‘ν„μ‹ κΈ°λ° μ£ΌκΈ° μ„¤μ •
- Graceful shutdown μ§€μ›
- μ¦‰μ‹ μ‹¤ν–‰ λ¨λ“ (ν…μ¤νΈμ©)

**μ¤μΌ€μ¤„ μ •μ**:
| μ£ΌκΈ° | μ‹κ°„ | λ€μƒ | μ΄μ  |
|------|------|------|------|
| λ§¤μΌ | 03:00 | λ¬Έν™”ν–‰μ‚¬, κ³µκ³µμμ•½ | λ³€λ™μ΄ μ¦μ€ λ°μ΄ν„° |
| λ§¤μ£Ό μ›”μ”μΌ | 04:00 | λ„μ„κ΄€, λ¬Έν™”κ³µκ°„ | λ³€λ™μ΄ μ μ€ λ°μ΄ν„° |
| λ§¤μ›” 1μΌ | 05:00 | λ―Έλμ μ‚° | κ±°μ λ³€ν•μ§€ μ•λ” λ°μ΄ν„° |

**μ‚¬μ© μμ‹**:
```bash
# μ¤μΌ€μ¤„λ¬ μ‹μ‘ (λ°±κ·ΈλΌμ΄λ“ μ‹¤ν–‰)
python scheduler.py

# μΌμΌ μμ§‘ μ¦‰μ‹ μ‹¤ν–‰ (ν…μ¤νΈ)
python scheduler.py --run-once daily

# μ£Όκ°„ μμ§‘ μ¦‰μ‹ μ‹¤ν–‰
python scheduler.py --run-once weekly

# μ›”κ°„ μμ§‘ μ¦‰μ‹ μ‹¤ν–‰
python scheduler.py --run-once monthly
```

**ν•µμ‹¬ κµ¬ν„**:
```python
class DataCollectionScheduler:
    def setup_jobs(self):
        # λ§¤μΌ 03:00 - λ¬Έν™”ν–‰μ‚¬, κ³µκ³µμμ•½
        self.scheduler.add_job(
            self.collect_daily_data,
            CronTrigger(hour=3, minute=0),
            id='daily_collection',
            name='μΌμΌ λ°μ΄ν„° μμ§‘ (λ¬Έν™”ν–‰μ‚¬, κ³µκ³µμμ•½)',
            replace_existing=True
        )

        # λ§¤μ£Ό μ›”μ”μΌ 04:00 - λ„μ„κ΄€, λ¬Έν™”κ³µκ°„
        self.scheduler.add_job(
            self.collect_weekly_data,
            CronTrigger(day_of_week='mon', hour=4, minute=0),
            id='weekly_collection',
            name='μ£Όκ°„ λ°μ΄ν„° μμ§‘ (λ„μ„κ΄€, λ¬Έν™”κ³µκ°„)',
            replace_existing=True
        )

        # λ§¤μ›” 1μΌ 05:00 - λ―Έλμ μ‚°
        self.scheduler.add_job(
            self.collect_monthly_data,
            CronTrigger(day=1, hour=5, minute=0),
            id='monthly_collection',
            name='μ›”κ°„ λ°μ΄ν„° μμ§‘ (λ―Έλμ μ‚°)',
            replace_existing=True
        )
```

### 3. data_quality_check.py - ν’μ§ κ²€μ¦
**νμΌ**: `backend/scripts/data_quality_check.py`

**κ²€μ¦ ν•­λ©**:
1. **μΆν‘ λ²”μ„ κ²€μ¦**: μ„μΈμ‹ κ²½κ³„ λ‚΄ μ„μΉ ν™•μΈ
   - μ„λ„: 37.413 ~ 37.715
   - κ²½λ„: 126.734 ~ 127.269
2. **μ¤‘λ³µ λ μ½”λ“ μ²΄ν¬**: `api_id` κΈ°μ¤€ μ¤‘λ³µ ν™•μΈ
3. **ν•„μ ν•„λ“ λ„λ½ μ²΄ν¬**: ν…μ΄λΈ”λ³„ ν•„μ ν•„λ“ κ²€μ¦
4. **ν…μ΄λΈ” κΈ°λ³Έ ν†µκ³„**: λ μ½”λ“ μ, ν•„λ“λ³„ NULL λΉ„μ¨

**μ‚¬μ© μμ‹**:
```bash
# μ „μ²΄ ν’μ§ κ²€μ¦
python data_quality_check.py

# λ¦¬ν¬νΈ νμΌ μ €μ¥
python data_quality_check.py --export

# νΉμ • ν…μ΄λΈ”λ§ κ²€μ¦
python data_quality_check.py --table cultural_events
```

**ν•µμ‹¬ κµ¬ν„**:
```python
class DataQualityChecker:
    def _check_coordinate_bounds(self, table: str):
        """μΆν‘ λ²”μ„ κ²€μ¦ (μ„μΈμ‹ λ‚΄)"""

        # μ„μΈμ‹ μΆν‘ λ²”μ„ (WGS84)
        SEOUL_BOUNDS = {
            'lat_min': 37.413,  # λ‚¨λ‹¨
            'lat_max': 37.715,  # λ¶λ‹¨
            'lon_min': 126.734,  # μ„λ‹¨
            'lon_max': 127.269   # λ™λ‹¨
        }

        # λ²”μ„ μ²΄ν¬
        if not (SEOUL_BOUNDS['lat_min'] <= lat <= SEOUL_BOUNDS['lat_max'] and
                SEOUL_BOUNDS['lon_min'] <= lon <= SEOUL_BOUNDS['lon_max']):
            out_of_bounds.append({
                'api_id': record['api_id'],
                'lat': lat,
                'lon': lon
            })
```

### 4. μΈν”„λΌ κ°μ„ 
**λ””λ ‰ν† λ¦¬ κµ¬μ΅°**:
```
backend/
β”β”€β”€ scripts/
β”‚   β”β”€β”€ collect_all.py          # ν†µν•© μμ§‘ μ¤ν¬λ¦½νΈ
β”‚   β”β”€β”€ scheduler.py            # μλ™ μ¤μΌ€μ¤„λ¬
β”‚   β”β”€β”€ data_quality_check.py   # ν’μ§ κ²€μ¦
β”‚   β””β”€β”€ collect_all_data.py     # κΈ°μ΅΄ μ¤ν¬λ¦½νΈ (νΈν™μ„±)
β”β”€β”€ logs/                        # μμ§‘ λ΅κ·Έ
β”‚   β”β”€β”€ collect_all.log
β”‚   β”β”€β”€ scheduler.log
β”‚   β””β”€β”€ full_collection.log
β””β”€β”€ reports/                     # ν’μ§ λ¦¬ν¬νΈ
    β””β”€β”€ data_quality_report.txt
```

**μμ΅΄μ„± μ¶”κ°€**:
```txt
# requirements.txtμ— μ¶”κ°€
tqdm==4.66.1  # μ§„ν–‰μƒν™© ν‘μ‹
apscheduler==3.10.4  # μ΄λ―Έ μ΅΄μ¬
```

---

## π“ μ΄κΈ° λ°μ΄ν„° μμ§‘ κ²°κ³Ό

### μμ§‘ μ§„ν–‰ μ¤‘ (2025-11-02 20:54 κΈ°μ¤€)
```
λ¬Έν™”ν–‰μ‚¬: 3,400/4,488 (75.8%) - μ§„ν–‰ μ¤‘
λ„μ„κ΄€: λ€κΈ° μ¤‘
λ¬Έν™”κ³µκ°„: λ€κΈ° μ¤‘
λ―Έλμ μ‚°: λ€κΈ° μ¤‘
κ³µκ³µμμ•½: λ€κΈ° μ¤‘
```

**μμƒ μµμΆ… μμ§‘λ‰**:
| ν…μ΄λΈ” | μμƒ λ μ½”λ“ μ | λΉ„κ³  |
|--------|--------------|------|
| λ¬Έν™”ν–‰μ‚¬ | ~4,488κ° | API μ „μ²΄ |
| λ„μ„κ΄€ | ~225κ° | κ³µκ³µλ„μ„κ΄€ + μ¥μ• μΈλ„μ„κ΄€ |
| λ¬Έν™”κ³µκ°„ | ~971κ° | μ „μ²΄ μμ§‘ |
| λ―Έλμ μ‚° | ~499κ° | Day 5 μ¤ν‚µ λ¬Έμ  ν•΄κ²° ν•„μ” |
| κ³µκ³µμμ•½ | ~1,129κ° | μλ£ + κµμ΅ + λ¬Έν™” |
| **ν•©κ³„** | **~7,312κ°** | |

---

## π” μ£Όμ” κΈ°μ μ  κ°μ„ μ‚¬ν•­

### 1. μ§„ν–‰μƒν™© ν‘μ‹ (tqdm)
- λ°±κ·ΈλΌμ΄λ“ μμ§‘λ„ μ‹¤μ‹κ°„ λ¨λ‹ν„°λ§ κ°€λ¥
- Collectorλ³„ μ§„ν–‰λ¥  ν‘μ‹
- μμƒ μ™„λ£ μ‹κ°„ κ³„μ‚°

### 2. λ΅κ·Έ κ΄€λ¦¬
- νμΌ + μ½μ†” λ™μ‹ λ΅κΉ…
- λ΅κ·Έ λ λ²¨ μ΅°μ • κ°€λ¥ (DEBUG, INFO, WARNING, ERROR)
- UTF-8 μΈμ½”λ”©μΌλ΅ ν•κΈ€ μ™„λ²½ μ§€μ›

### 3. Graceful Shutdown
- SIGINT (Ctrl+C), SIGTERM μ‹κ·Έλ„ ν•Έλ“¤λ§
- μ§„ν–‰ μ¤‘μΈ μμ§‘ μ™„λ£ ν›„ μΆ…λ£
- λ°μ΄ν„° λ¬΄κ²°μ„± λ³΄μ¥

### 4. ν’μ§ κ²€μ¦ μλ™ν™”
- μμ§‘ ν›„ μ¦‰μ‹ ν’μ§ κ²€μ¦ κ°€λ¥
- λ¦¬ν¬νΈ νμΌ μλ™ μ €μ¥
- CI/CD νμ΄ν”„λΌμΈ ν†µν•© κ°€λ¥

---

## π― λ°κ²¬λ μ΄μ λ° ν–¥ν›„ μ‘μ—…

### λ°κ²¬λ μ΄μ

#### 1. Future Heritages μμ§‘ λ¬Έμ  (Day 5 λ―Έν•΄κ²°)
- **ν„μƒ**: 499κ° λ μ½”λ“ μ „μ²΄ μ¤ν‚µ
- **μ°μ„ μμ„**: λ†’μ
- **μ΅°μΉ**: Day 7μ—μ„ λ””λ²„κΉ… μμ •

#### 2. Collection Logs μ¤ν‚¤λ§ λ¶μΌμΉ (Day 5 λ―Έν•΄κ²°)
- **ν„μƒ**: `records_collected` μ»¬λΌ λ¶μΌμΉ
- **μν–¥**: μμ§‘ λ΅κ·Έ μ €μ¥ μ‹¤ν¨ (λ°μ΄ν„° μμ§‘μ€ μ •μƒ)
- **μ°μ„ μμ„**: μ¤‘κ°„
- **μ΅°μΉ**: Day 7μ—μ„ μμ •

### Day 7 μ‘μ—… κ³„ν

1. **Future Heritages λ””λ²„κΉ…**
   - κ°λ³„ λ μ½”λ“ ν…μ¤νΈ
   - transform_record() λ΅μ§ κ²€μ¦
   - ν•„μ ν•„λ“ μ²΄ν¬

2. **Collection Logs μμ •**
   - Supabase μ¤ν‚¤λ§ ν™•μΈ
   - BaseCollector._log_collection() λ©”μ„λ“ μμ •

3. **λ°μ΄ν„° ν’μ§ κ²€μ¦ μ‹¤ν–‰**
   - μ „μ²΄ μμ§‘ μ™„λ£ ν›„ ν’μ§ κ²€μ¦
   - λ¦¬ν¬νΈ μƒμ„± λ° λ¶„μ„

4. **μ§€μ¤μ½”λ”© κµ¬ν„** (μ„ νƒ)
   - Kakao Local API ν†µν•©
   - λ¬Έν™”κ³µκ°„/λ―Έλμ μ‚° μ£Όμ† β†’ μΆν‘ λ³€ν™

---

## π’΅ μ•„ν‚¤ν…μ² κ°μ„ μ‚¬ν•­

### μμ§‘ μ‹μ¤ν… κ³„μΈµ κµ¬μ΅°
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚      Scheduler (scheduler.py)       β”‚  β† Cron κΈ°λ° μλ™ μ‹¤ν–‰
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
             β”‚
             β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  Orchestrator (collect_all.py)      β”‚  β† μμ§‘ νλ¦„ μ μ–΄
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
             β”‚
             β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   Individual Collectors (5κ°)       β”‚  β† λ°μ΄ν„° μμ§‘ μ‹¤ν–‰
β”‚   - CulturalEventsCollector         β”‚
β”‚   - LibrariesCollector              β”‚
β”‚   - CulturalSpacesCollector         β”‚
β”‚   - FutureHeritagesCollector        β”‚
β”‚   - PublicReservationsCollector     β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
             β”‚
             β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚      Supabase PostgreSQL            β”‚  β† λ°μ΄ν„° μ €μ¥
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
             β”‚
             β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ Quality Checker (data_quality_*.py) β”‚  β† ν’μ§ κ²€μ¦
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### μ¤μΌ€μ¤„λ§ μ „λµ
- **Daily (λ§¤μΌ 03:00)**: λ¬Έν™”ν–‰μ‚¬, κ³µκ³µμμ•½
  - μ΄μ : μμ•½ μ‹μ‘/μΆ…λ£μΌμ΄ μμ£Ό λ³€κ²½λ¨
- **Weekly (λ§¤μ£Ό μ›”μ”μΌ 04:00)**: λ„μ„κ΄€, λ¬Έν™”κ³µκ°„
  - μ΄μ : μ΄μμ‹κ°„, ν΄κ΄€μΌ λ“± λ³€κ²½ λΉλ„ λ‚®μ
- **Monthly (λ§¤μ›” 1μΌ 05:00)**: λ―Έλμ μ‚°
  - μ΄μ : μ§€μ • μ΄ν›„ κ±°μ λ³€ν•μ§€ μ•μ

---

## π“ ν”„λ΅μ νΈ μ§„ν–‰λ¥ 

```
Week 1 Progress: β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–‘ 90%

β… Day 1: ν”„λ΅μ νΈ κµ¬μ΅° λ° ν™κ²½ μ„¤μ •
β… Day 2: Seoul API Client λ° κΈ°λ³Έ Collector κµ¬ν„
β… Day 3: 5κ° λ°μ΄ν„° μμ§‘κΈ° κµ¬ν„
β… Day 4: λ°μ΄ν„° μμ§‘ ν…μ¤νΈ λ° μ¤ν‚¤λ§ κ²€μ¦
β… Day 5: μ¤ν‚¤λ§ μμ • λ° λ°μ΄ν„° μμ§‘ κ²€μ¦
β… Day 6: μλ™ μμ§‘ μ‹μ¤ν… κµ¬μ¶• β† ν„μ¬
β¬ Day 7: Week 1 μµμΆ… κ²€μ¦ λ° λ¬Έμ„ν™”
```

---

## π‰ κ²°λ΅ 

Day 6λ” **λ°μ΄ν„° μμ§‘ μλ™ν™”**λΌλ” ν•µμ‹¬ λ©ν‘λ¥Ό μ„±κ³µμ μΌλ΅ λ‹¬μ„±ν–μµλ‹λ‹¤.

### ν•µμ‹¬ μ„±κ³Ό
1. **ν”„λ΅λ•μ…κΈ‰ μμ§‘ μ‹μ¤ν…**: tqdm μ§„ν–‰ ν‘μ‹, λ΅κΉ…, Graceful shutdown
2. **μλ™ μ¤μΌ€μ¤„λ§**: μ£ΌκΈ°λ³„ λ§μ¶¤ν• μμ§‘ μ „λµ
3. **ν’μ§ κ²€μ¦ μ‹μ¤ν…**: μΆν‘ λ²”μ„, μ¤‘λ³µ, ν•„μ ν•„λ“ κ²€μ¦
4. **ν™•μ¥ κ°€λ¥ν• μ•„ν‚¤ν…μ²**: μƒλ΅μ΄ Collector μ¶”κ°€ μ©μ΄

### λ‹¤μ λ‹¨κ³„
Day 7μ—μ„λ” Future Heritages λ””λ²„κΉ…, ν’μ§ κ²€μ¦ λ¦¬ν¬νΈ μƒμ„±, Week 1 μµμΆ… λ¬Έμ„ν™”λ¥Ό μ™„λ£ν•  μμ •μ…λ‹λ‹¤.

**μμ§‘μ΄ μ™„λ£λλ©΄ μ‹¤μ  λ°μ΄ν„° ν†µκ³„λ¥Ό μ—…λ°μ΄νΈν•κ² μµλ‹λ‹¤.**

---

**μ‘μ„±μ**: Claude Code
**κ²€ν† **: Day 6 μ™„λ£ μ‹μ 
**λ‹¤μ λ¦¬λ·°**: Day 7 μ‹μ‘ μ „
